# =============================================================================
# Ontologie Documentation Technique
# =============================================================================
# Spécialisée pour l'extraction d'informations depuis la documentation
# technique : API, architecture, spécifications, guides d'intégration.

name: technical
version: "1.0"
description: |
  Ontologie spécialisée pour la documentation technique.
  Optimisée pour extraire les composants logiciels, API, configurations,
  dépendances, versions, et spécifications techniques.

# Instructions spécifiques pour le LLM
context: |
  Tu es un expert en architecture logicielle et documentation technique.
  Tu dois identifier avec précision :
  - Les composants logiciels et leurs versions
  - Les API et endpoints
  - Les protocoles et formats de données
  - Les dépendances et prérequis
  - Les configurations et paramètres
  - Les flux de données et intégrations
  - Les contraintes techniques et limites
  
  IMPORTANT: La précision des versions et des spécifications techniques est cruciale.
  Note toujours les versions exactes et les formats de données.

# =============================================================================
# Types d'entités spécifiques à la Documentation Technique
# =============================================================================
entity_types:
  # Composants logiciels
  - name: Component
    description: Composant logiciel, module, service
    examples:
      - "API Gateway"
      - "Service d'authentification"
      - "Module de cache"
      - "Worker de traitement"

  - name: Application
    description: Application complète
    examples:
      - "Console Shiva"
      - "Portail client"
      - "Application mobile iOS"

  - name: Library
    description: Bibliothèque ou framework
    examples:
      - "FastAPI 0.100"
      - "React 18.2"
      - "Neo4j Driver 5.x"
      - "boto3 1.28"

  - name: Database
    description: Base de données
    examples:
      - "Neo4j 5.x"
      - "PostgreSQL 15"
      - "Redis 7"
      - "Elasticsearch 8"

  # API et Interfaces
  - name: API
    description: Interface de programmation
    examples:
      - "REST API v2"
      - "GraphQL API"
      - "gRPC Service"
      - "WebSocket API"

  - name: Endpoint
    description: Point de terminaison API
    examples:
      - "POST /api/v2/memories"
      - "GET /health"
      - "DELETE /documents/{id}"

  - name: HTTPMethod
    description: Méthode HTTP
    examples:
      - "GET"
      - "POST"
      - "PUT"
      - "DELETE"
      - "PATCH"

  - name: StatusCode
    description: Code de statut HTTP
    examples:
      - "200 OK"
      - "201 Created"
      - "400 Bad Request"
      - "401 Unauthorized"

  # Formats et Protocoles
  - name: DataFormat
    description: Format de données
    examples:
      - "JSON"
      - "XML"
      - "Protocol Buffers"
      - "MessagePack"
      - "Base64"

  - name: Protocol
    description: Protocole de communication
    examples:
      - "HTTPS"
      - "WebSocket"
      - "SSE (Server-Sent Events)"
      - "AMQP"

  - name: AuthMethod
    description: Méthode d'authentification
    examples:
      - "Bearer Token"
      - "OAuth 2.0"
      - "API Key"
      - "mTLS"

  # Configuration
  - name: Configuration
    description: Paramètre de configuration
    examples:
      - "NEO4J_URI"
      - "S3_BUCKET_NAME"
      - "MAX_TOKENS=60000"

  - name: EnvironmentVariable
    description: Variable d'environnement
    examples:
      - "LLMAAS_API_KEY"
      - "DEBUG=true"
      - "PORT=8002"

  - name: ConfigFile
    description: Fichier de configuration
    examples:
      - ".env"
      - "docker-compose.yml"
      - "config.yaml"

  # Versions et Dépendances
  - name: Version
    description: Version d'un composant
    priority: high
    examples:
      - "v2.1.0"
      - "Python 3.11+"
      - "API v2"

  - name: Dependency
    description: Dépendance logicielle
    examples:
      - "mcp>=1.0.0"
      - "fastapi>=0.100.0"
      - "neo4j>=5.0.0"

  - name: Requirement
    description: Prérequis système
    examples:
      - "Docker 24+"
      - "Python 3.11+"
      - "16 Go RAM minimum"

  # Modèles de données
  - name: DataModel
    description: Modèle de données, schéma
    examples:
      - "Entity"
      - "Document"
      - "Memory"
      - "ExtractionResult"

  - name: Field
    description: Champ ou attribut
    examples:
      - "memory_id: string"
      - "content_base64: string"
      - "created_at: datetime"

  - name: DataType
    description: Type de données
    examples:
      - "string"
      - "integer"
      - "boolean"
      - "array"
      - "object"

  # Sécurité
  - name: SecurityMechanism
    description: Mécanisme de sécurité
    examples:
      - "Chiffrement TLS 1.3"
      - "RBAC"
      - "Rate Limiting"
      - "Input Validation"

  - name: Permission
    description: Permission ou rôle
    examples:
      - "read"
      - "write"
      - "admin"
      - "memory:create"

  # Métriques et Limites
  - name: RateLimit
    description: Limite de débit
    examples:
      - "100 requêtes/minute"
      - "10 Mo/fichier"
      - "1000 tokens/seconde"

  - name: Timeout
    description: Délai d'expiration
    examples:
      - "Timeout: 30s"
      - "Connection timeout: 10s"
      - "Read timeout: 60s"

  - name: PerformanceSpec
    description: Spécification de performance
    examples:
      - "Latence P99 < 100ms"
      - "Throughput: 1000 req/s"
      - "Max concurrent: 100"

  # Documentation
  - name: Example
    description: Exemple de code ou d'utilisation
    examples:
      - "Exemple curl"
      - "Code Python"
      - "Request body example"

  - name: Error
    description: Type d'erreur
    examples:
      - "ValidationError"
      - "AuthenticationError"
      - "RateLimitExceeded"

# =============================================================================
# Types de relations spécifiques à la Documentation Technique
# =============================================================================
relation_types:
  - name: EXPOSES
    description: Expose une API ou endpoint
    examples:
      - "Service → EXPOSES → REST API"
      - "API → EXPOSES → POST /memories"

  - name: DEPENDS_ON
    description: Dépend de
    examples:
      - "API Service → DEPENDS_ON → Neo4j"
      - "Component → DEPENDS_ON → Redis"

  - name: USES
    description: Utilise une technologie
    examples:
      - "Extractor → USES → LLMaaS"
      - "Storage → USES → S3"

  - name: AUTHENTICATES_WITH
    description: S'authentifie avec
    examples:
      - "API → AUTHENTICATES_WITH → Bearer Token"

  - name: RETURNS
    description: Retourne un format/type
    examples:
      - "Endpoint → RETURNS → JSON"
      - "Method → RETURNS → ExtractionResult"

  - name: ACCEPTS
    description: Accepte un format/type
    examples:
      - "Endpoint → ACCEPTS → multipart/form-data"

  - name: HAS_VERSION
    description: Possède une version
    examples:
      - "API → HAS_VERSION → v2.1.0"

  - name: REQUIRES
    description: Nécessite un prérequis
    examples:
      - "Deployment → REQUIRES → Docker"

  - name: CONTAINS
    description: Contient un composant
    examples:
      - "Service → CONTAINS → AuthMiddleware"

  - name: IMPLEMENTS
    description: Implémente un pattern/interface
    examples:
      - "TokenManager → IMPLEMENTS → CRUD"

  - name: STORES_IN
    description: Stocke dans
    examples:
      - "Document → STORES_IN → S3"
      - "Entity → STORES_IN → Neo4j"

  - name: CALLS
    description: Appelle un service
    examples:
      - "Extractor → CALLS → LLMaaS API"

  - name: CONFIGURED_BY
    description: Configuré par
    examples:
      - "Service → CONFIGURED_BY → .env"

  - name: LIMITS
    description: Limite imposée
    examples:
      - "API → LIMITS → 100 req/min"

  - name: THROWS
    description: Peut lever une erreur
    examples:
      - "Endpoint → THROWS → ValidationError"

  - name: DOCUMENTED_IN
    description: Documenté dans
    examples:
      - "API → DOCUMENTED_IN → README.md"

# =============================================================================
# Règles d'extraction spécifiques
# =============================================================================
extraction_rules:
  max_entities: 60
  max_relations: 80
  include_metrics: true
  include_durations: true
  include_amounts: false
  extract_implicit_relations: true
  
  priority_entities:
    - API
    - Endpoint
    - Component
    - Version
    - Dependency
    - Configuration
    - DataModel

  special_instructions: |
    - Identifie TOUTES les versions (logiciels, API, protocoles)
    - Extrais TOUS les endpoints avec leurs méthodes HTTP
    - Note les formats de données (JSON, XML, etc.)
    - Identifie les mécanismes d'authentification
    - Extrais les limites et timeouts
    - Note les dépendances avec leurs versions minimum

# =============================================================================
# Exemples d'extraction
# =============================================================================
examples:
  - input: |
      L'API REST v2 expose l'endpoint POST /api/v2/memories pour créer une mémoire.
      Authentification par Bearer Token requise.
      Le body doit être en JSON avec les champs: memory_id (string), name (string).
      Retourne 201 Created avec la mémoire créée.
      Rate limit: 100 requêtes par minute.
      Dépendances: Python 3.11+, FastAPI 0.100+, Neo4j 5.x.
    expected_entities:
      - {name: "API REST v2", type: "API"}
      - {name: "POST /api/v2/memories", type: "Endpoint"}
      - {name: "Bearer Token", type: "AuthMethod"}
      - {name: "JSON", type: "DataFormat"}
      - {name: "memory_id", type: "Field", description: "string"}
      - {name: "name", type: "Field", description: "string"}
      - {name: "201 Created", type: "StatusCode"}
      - {name: "100 req/min", type: "RateLimit"}
      - {name: "Python 3.11+", type: "Requirement"}
      - {name: "FastAPI 0.100+", type: "Dependency"}
      - {name: "Neo4j 5.x", type: "Dependency"}
    expected_relations:
      - {from: "API REST v2", to: "POST /api/v2/memories", type: "EXPOSES"}
      - {from: "POST /api/v2/memories", to: "Bearer Token", type: "AUTHENTICATES_WITH"}
      - {from: "POST /api/v2/memories", to: "JSON", type: "ACCEPTS"}
      - {from: "POST /api/v2/memories", to: "201 Created", type: "RETURNS"}
      - {from: "API", to: "100 req/min", type: "LIMITS"}
